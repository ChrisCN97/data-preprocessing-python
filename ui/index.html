<html>
<head>
    <title>DPTools</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="img/icon.png" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/file-tree.css">
    <link rel="stylesheet" href="css/index.css">
</head>
<body>

<!-- 抬头 -->
<div class="jumbotron"  style="background-image: url(img/backimg.jpg); color: white; background-position-y: 50%; box-shadow: 0px 0px 5px black;">
    <div class="container">
        <h2>欢迎使用Python数据预处理工具!</h2>
        <p>support by: 
            <span class="label label-primary">张晋豪</span>
            <span class="label label-primary">李经纬</span>
            <span class="label label-primary">崔楠</span>
            <span class="label label-primary">李宇</span>
            <span class="label label-primary">刘润扬</span>
            <span class="label label-primary">蒲治北</span>
        </p>
    </div>
</div>

<button id="btn-open" class="btn btn-default special-button" data-toggle="modal" data-target="#file-explorer">open</button>
<button id="btn-save" class="btn btn-default special-button" type="button">save</button>

<div id="main-container" class="container">

    <!-- 显示输入数据路径 -->
    <div class="panel panel-default" style="padding: 5px;">
        <div>
            <span class="label label-info">输入文件</span>
            <span id="main-input-path"></span>
        </div>
    </div>

    <!-- 数据预览 -->
    <div class="panel panel-default" style="position: relative;">
        <div id="btn-refresh" data-toggle="tooltip" data-placement="bottom" title="刷新数据预览"></div>
        <pre id="data-preview" placeholder="数据预览"></pre>
    </div>
    
    <!-- 功能按键 -->
    <div class="panel panel-default">
        <div class="panel-body">
            <div class="container">

                <!-- 筛选 -->
                <div class="row">
                    <div class="col-md-6 col-sm-6 col-xs-6 dropdown content-center">
                        <button type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
                            <h6>选择属性名</h6>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu"></ul>
                    </div>
                    
                    <div class="col-md-6 col-sm-6 col-xs-6 dropdown content-center">
                        <button type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
                            <h6>属性类型</h6>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu"></ul>
                    </div>
                </div>

                <hr />

                <!-- 空缺值处理 -->
                <div class="row">
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <h4>空缺值处理</h4>
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <button id="null-process-mean" type="button" class="btn btn-info">均值</button>
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <button id="null-process-var" type="button" class="btn btn-info">均值-方差</button>
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <button id="null-process-normal" type="button" class="btn btn-info">正态随机</button>
                    </div>
                </div>
        
                <!-- 噪声处理 -->
                <div class="row">
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <h4>噪声处理</h4>
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <button id="noise-process-avg" type="button" class="btn btn-info">平均值</button>
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <button id="noise-process-border" type="button" class="btn btn-info">边界值</button>
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <button id="noise-process-mid" type="button" class="btn btn-info">中值</button>
                    </div>
                </div>
        
                <!-- 数据规范化 -->
                <div class="row">
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <h4>数据规范化</h4>
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <button id="normalize-min-max" type="button" class="btn btn-info">min-max</button>
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <button id="normalize-z-score" type="button" class="btn btn-info">z-score</button>
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <button id="normalize-calibrating" type="button" class="btn btn-info">小数标定</button>
                    </div>
                </div>
                
                <!-- 数据可视化 -->
                <div class="row">
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <h4>数据可视化</h4>
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <button id="visual-bar" type="button" class="btn btn-info">条形图</button>
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <button id="visual-line" type="button" class="btn btn-info">折线图</button>
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-3 dropdown content-center">
                        <button id="visual-pie" type="button" class="btn btn-info">饼图</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- 文件浏览器 -->
    <div id="file-explorer" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">文件浏览</h4>
                </div>
                <div id="ft-container" class="modal-body">
                    <div class="panel panel-default" style="padding: 5px;">
                        <div>
                            <span class="label label-info">输入文件</span>
                            <span id="ft-input-path"></span>
                        </div>
                    </div>
                    <!-- ft 元素将通过 js 加入 dom -->
                </div>
                <div class="modal-footer">
                    <button id="btn-ft-backup" class="btn btn-default" type="button">后退</button>
                    <button id="btn-ft-confirm" type="button" class="btn btn-primary">选择文件</button>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="/eel.js"></script>
<script src="js/util.js"></script>
<script src="js/ft.js"></script>
<script src="js/index.js"></script>
<script>
    const path_seperator = detectOS().startsWith('Win') ? '\\' : '/'
    const preview_data = (data) => {
        $('#data-preview').text(data)
    }

    let ft_input_path = $('#ft-input-path')
    let main_input_path = $('#main-input-path')

    /* file tree */
    let file_explorer = $('#file-explorer')

    let ft = new FileTree((path, resolveView) => {
        eel.open_path(path)((data) => resolveView(JSON.parse(data)))
    }, (path) => {
        ft_input_path.text(path)
    })

    // 初始化文件浏览器，使用工作目录作为文件树根节点
    eel.get_cwd()((cwd) => {
        $('#ft-container').append(ft.render({ name: cwd, type: 'dir'}))
    })

    $('#btn-ft-backup').click(() => ft.load_parent())

    // 选择文件按钮，绑定 click 事件
    $('#btn-ft-confirm').click(() => {
        let path = ft_input_path.text()
        if (path) {
            main_input_path.text(path)
            file_explorer.modal('toggle')
            eel.get_data(path)((data) => preview_data(JSON.parse(data).data))
        }
        else alert('请选择一个数据文件')
    })

    /* data preview */

    let btn_refresh = $('#btn-refresh')
    btn_refresh.tooltip()
    btn_refresh.click(() => {})

    $('#btn-open').click()

    /* other */
    
    // 空缺值处理

    $('#null-process-mean').click(() => {
        eel.null_process(0)((data) => preview_data(JSON.parse(data).data))
    })

    $('#null-process-var').click(() => {
        eel.null_process(1)
    })

    $('#null-process-normal').click(() => {
        eel.null_process(2)
    })

    // 噪音处理

    $('#noise-process-avg').click(() => {
        eel.noise_process(0)
    })

    $('#noise-process-border').click(() => {
        eel.noise_process(1)
    })

    $('#noise-process-mid').click(() => {
        eel.noise_process(2)
    })

    // 数据规范化

    $('#normalize-min-max').click(() => {
        eel.normalize(0)((data) => preview_data(JSON.parse(data).data))
    })

    $('#normalize-z-score').click(() => {
        eel.normalize(1)
    })

    $('#normalize-calibrating').click(() => {
        eel.normalize(2)
    })

    // 数据可视化

    $('#visual-bar').click(() => {
        eel.draw_bar()
    })

    $('#visual-line').click(() => {
        eel.draw_line()
    })

    $('#visual-pie').click(() => {
        eel.draw_pie()
    })
</script>

</body>
</html>